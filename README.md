Completely re written.

Now has symbolic integration
